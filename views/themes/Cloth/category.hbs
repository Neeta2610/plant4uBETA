<div class="Wrapper-product top-marg-150" >
<div class="filter displaynone">

        <div class="shop_sidebar_area">

            {{#each filters}}
            <!-- ##### Single Widget ##### -->
            <div class="widget brands bottom-marg-50">
                <!-- Widget Title -->
                <h6 class="widget-title mb-30">{{this.title}}</h6>

                <div class="widget-desc">
                    <!-- Single Form Check -->
                    {{#each this.submenu}}
                    <div class="form-check">
                        {{#ifIn this.id ../../appliedfilters}}
                        <input class="form-check-input removefilters" type="checkbox" value="{{this}}" id="amado" checked>
                        {{else}}
                        <input class="form-check-input applyfilters" type="checkbox" value="{{this}}" id="amado">
                        {{/ifIn}}
                        <label class="form-check-label" for="amado">{{this.title}}</label>
                    </div>
                    {{/each}}
                </div>
            </div>
            {{/each}}

            <!-- ##### Single Widget ##### -->
            <div class="widget price bottom-marg-50">
                <!-- Widget Title -->
                <h6 class="widget-title mb-30">Price</h6>

                <div class="widget-disc">
                    <div id="slider-range"></div>
                    <div id="pricerange" class="top-marg-25"></div>
                    {{#if appliedprice}}
                    <input type="hidden" id="min-value" value="{{this.appliedprice.[0]}}">
                    <input type="hidden" id="max-value" value="{{this.appliedprice.[1]}}">
                    {{else}}
                    <input type="hidden" id="min-value">
                    <input type="hidden" id="max-value">
                    {{/if}}
                </div>
            </div>

            <!-- ##### Single Widget ##### -->
            {{#each categories}}
            <div class="widget catagory bottom-marg-50">
                <!-- Widget Title -->
                <h6 class="widget-title mb-30">{{this.title}}</h6>

                <!--  Catagories  -->
                <div class="catagories-menu">
                    <ul>
                        {{#each this.submenu}}
                        <li class=""><a href="/category/{{this}}">{{this}}</a></li>
                        {{/each}}
                    </ul>
                </div>
            </div>
            {{/each}}
        </div>
</div>
<div class="productsWrapper">
    {{#if filtered}}
        <div class="product-results col-sm-12">
                    <div class="dropdown show">
        <a class="btn btn-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Show
        </a>

        <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
            <a class="dropdown-item" href="#">10</a>
            <a class="dropdown-item" href="#">30</a>
            <a class="dropdown-item" href="#">All</a>
        </div>
        </div>
            {{#ifCond @root.paginateUrl '==' 'category'}}
            <h1>{{ @root.__ "Category" }} - <strong>{{@root.searchTerm}}</strong></h1>
            {{else}}
            <h1>{{ @root.__ "Search results" }} - <strong>{{@root.searchTerm}}</strong></h1>
            {{/ifCond}}
        </div>
    {{/if}}
    <div class="row product-layout">
        {{#ifCond results.length '==' 0}}
            <div class="col-sm-12">
                <img src="/images/no-product-found.png" alt="No Product Found" class="mx-auto">
            </div>
        {{/ifCond}}
        {{#each results}}
          <div class="col-12 col-sm-6 col-lg-5 col-xl-4">
                        <div class="single-product-wrapper">
                            <!-- Product Image -->
                                {{#if productPermalink}}
                             <a href="/product/{{this.productPermalink}}">
                            <div class="product-img">
                                {{#if productImage}}
                                
                                    <img src="{{this.productImage.[0].path}}" alt="First Uploaded Image">
                                    <!-- Hover Thumb -->
                                    <img class="hover-img" src="{{this.productImage.[1].path}}" alt="Second Image">
                                {{else}}
                                    <img src="/images/p5.jpg" alt="First Image">
                                    <!-- Hover Thumb -->
                                    <img class="hover-img" src="/images/p1.jpg" alt="Second Image">
                                {{/if}}
                            </div>
                            </a>
                            {{else}}
                            <a href="/product/{{this._id}}">
                            <div class="product-img">
                                {{#if productImage}}
                                
                                    <img src="{{this.productImage.[0].path}}" alt="First Uploaded Image">
                                    <!-- Hover Thumb -->
                                    <img class="hover-img" src="{{this.productImage.[1].path}}" alt="Second Image">
                                {{else}}
                                    <img src="/images/p5.jpg" alt="First Image">
                                    <!-- Hover Thumb -->
                                    <img class="hover-img" src="/images/p1.jpg" alt="Second Image">
                                {{/if}}
                            </div>
                            </a>
                            {{/if}}

                            <!-- Product Description -->
                            <div class="product-description d-flex align-items-center justify-content-between">
                                <!-- Product Meta Data -->
                                <div class="product-meta-data">
                                    <div class="line"></div>
                                    <p class="product-price">{{currencySymbol @root.config.currencySymbol}}{{formatAmount productPrice}}</p>
                                    {{#if productPermalink}}
                                    <a href="/product/{{this.productPermalink}}">
                                        <h6>{{this.productTitle}}</h6>
                                    </a>
                                    {{else}}
                                    <a href="/product/{{this._id}}">
                                        <h6>{{this.productTitle}}</h6>
                                    </a>
                                    {{/if}}
                                </div>
                                <!-- Ratings & Cart -->
                                <div class="ratings-cart text-right">
                                    <div class="ratings">
                                        {{#forTimes this.productRating}}
                                        <i class="fas fa-star i"></i>
                                        {{/forTimes}}
                                        {{#forTimesminus this.productRating}}
                                        <i class="far fa-star i"></i>
                                        {{/forTimesminus}}
                                    </div>
                                    <div class="cart">
                                        {{#if this.productStock}}
                                        <a class="btn-round" data-toggle="tooltip" data-placement="left" title="Add to Cart" data-id="{{this._id}}" data-link="{{this.productPermalink}}" data-has-variants="{{checkProductVariants this.variants}}"><img src="/images/cart.png" alt=""></a>
                                        {{else}}
                                        <a class=""><img src="/images/cart.png" alt=""></a>
                                        {{/if}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
        {{/each}}
    </div>
</div> 
</div>
<button class="expand-filter">Filter<i class="fas fa-sort-amount-up-alt"></i></button>
<script>
    function addParameter(url, parameterName, parameterValue){
        replaceDuplicates = true;
        if(url.indexOf('#') > 0){
            var cl = url.indexOf('#');
            urlhash = url.substring(url.indexOf('#'),url.length);
        } else {
            urlhash = '';
            cl = url.length;
        }
        sourceUrl = url.substring(0,cl);
    
        var urlParts = sourceUrl.split("?");
        var newQueryString = "";
    
        if (urlParts.length > 1)
        {
            var filterType = urlParts[1].split('&');
            if(filterType.length > 1){
                if(parameterName == "filter"){
                    newQueryString = "?"+filterType[0] + "_" + parameterValue +"&"+ filterType[1];
                }
                else{
                    newQueryString = "?"+filterType[0]  + "&" + parameterName+"="+parameterValue;
                }
            }
            else{
                if(parameterName == filterType[0].split('=')[0] && parameterName == "filter"){
                    newQueryString = "?"+filterType[0] + "_" + parameterValue;
                }
                else if(parameterName == filterType[0].split('=')[0]){
                    newQueryString = "?"+parameterName + "=" + parameterValue;
                }
                else if(parameterName == "filter"){
                    newQueryString = "?"+parameterName + "=" + parameterValue+"&"+urlParts[1];
                }
                else{
                    newQueryString = "?"+urlParts[1] + "&" + parameterName+"="+parameterValue;
                }
            }
        }
        else{
            newQueryString = "?" + parameterName + "=" + parameterValue;
        }
        
        return urlParts[0] + newQueryString + urlhash;
    };
    $( function() {
    var min = 49;
    var max = 500;
    if($('#min-value').val && $('#min-value').val()){
        min = $('#min-value').val();
    }
    if($('#max-value').val && $('#max-value').val()){
        max = $('#max-value').val();
    }
    $( "#slider-range" ).slider({
      range: true,
      min: 49,
      max: 5000,
      values: [ min, max ],
      slide: function( event, ui ) {
        $('#pricerange')[0].innerHTML = "₹"+ui.values[0] + " - " + "₹"+ui.values[1];
        $( "#min-value" ).val( ui.values[ 0 ] );
        $( "#max-value" ).val( ui.values[ 1 ] );
      },
      stop: function( event, ui ) {
        var maxvalue = document.getElementById('max-value').value;
        var minvalue = document.getElementById('min-value').value;
        var id = minvalue+"_"+maxvalue;
        var url = addParameter(window.location.href, 'price', id);
        console.log(url);
        location.href = url;
      }
    });
    $('#pricerange')[0].innerHTML = "₹"+min + " - " + "₹"+max;
  } );
</script>
